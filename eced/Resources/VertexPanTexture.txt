#version 330 core

layout(location=0) in vec4 point;
layout(location=1) in vec2 uvcoord;

smooth out vec2 tileloc;

uniform vec2 pan;
uniform ivec2 window;
uniform float zoom;
uniform float tilesize;
uniform float fov; 
uniform mat4 project;
uniform ivec2 mapsize;

void main()
{
	float mapScaleX = float(mapsize.x) / 64.0f;
	float mapScaleY = float(mapsize.y) / 64.0f;
	vec4 scaledPt = vec4(point.x * mapScaleX, point.y * mapScaleY, point.z, point.w);
    vec4 pannedPt = scaledPt - vec4(mapScaleX / 2.0f, mapScaleY / 2.0f, 0.0, 0.0) + vec4(pan.x, pan.y, 0.0, 0.0);
	//gl_Position = vec4(point.x, -point.y, 0.0, 1.0);
	gl_Position = vec4(pannedPt.x * zoom, -pannedPt.y * zoom, pannedPt.z, pannedPt.w) * project;
    //theColor = color;
	//tileLoc = (point.xy / tilesize * zoom) / window; 
	tileloc = scaledPt.xy * tilesize; 
}